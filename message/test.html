<!DOCTYPE html>
<html lang="ja">

<head>
	<title>ã²ãŸã¡å…‰æ•™ä¼šã‚¢ãƒ—ãƒª</title>
	<meta name="robots" content="noindex,nofollow,noarchive" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" , maximum-scale=1.0, user-scalable=no>
	<meta charset="utf-8">
	<meta property="og:url" content="https://hitachihikari.net/message/">
	<meta property="og:title" content="ã²ãŸã¡å…‰æ•™ä¼šã‚¢ãƒ—ãƒª">
	<meta property="og:site_name" content="ã²ãŸã¡å…‰æ•™ä¼šã‚¢ãƒ—ãƒª">
	<meta property="og:image" content="https://hitachihikari.net/bible.png">
	<link href="https://hitachihikari.net/bible.png" rel="shortcut icon">
	<link href="https://hitachihikari.net/bible.png" rel="apple-touch-icon">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="manifest" href="./manifest.json">
	ã€€
	<meta name="theme-color" content="#198754">
	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker.register('./service-worker.js')
					.then(function (registration) {
						console.log('ServiceWorkerç™»éŒ²æˆåŠŸ:', registration.scope);
					}, function (err) {
						console.log('ServiceWorkerç™»éŒ²å¤±æ•—:', err);
					});
			});
		}
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
	<script src="https://unpkg.com/tiny-segmenter"></script>
	<style>
		body {
			font-family: 'Noto Sans JP', sans-serif;
			font-size: 1rem;
			line-height: 1.6;
			color: #212529;
			margin: 0;
			padding: 0;
		}

		.btn-hhc {
			width: 100%;
			font-weight: 500;
			padding: 0.75rem;
			font-size: 1rem;
			border: 1px solid #6c757d;
			background-color: #fff;
			color: #495057;
			border-radius: 2rem;
			box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
			transition: all 0.2s ease-in-out;
		}

		#hymnButtons {
			display: flex;
			flex-wrap: wrap;
			justify-content: flex-start;
			/* å·¦æƒãˆã« */
			gap: 0.5rem;
		}

		.btn-kashi {
			width: 50px;
			/* ã™ã¹ã¦åŒã˜å¹… */
			text-align: center;
			/* ä¸­å¤®æƒãˆï¼ˆå·¦æƒãˆã«ã—ãŸã„å ´åˆã¯ leftï¼‰ */
			padding: 0.5rem 0.75rem;
			margin: 0;
			/* å¿µã®ãŸã‚ä½™ç™½ãƒªã‚»ãƒƒãƒˆ */
			flex-shrink: 0;
			/* å¹…ã‚’ç¶­æŒ */
		}

		.btn-empty-meaning {
			background-color: #dee2e6 !important;
			/* Bootstrapã®æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
			color: #495057 !important;
			border-color: #ced4da !important;
			pointer-events: auto;
		}

		.btn-empty-meaning:hover {
			background-color: #dee2e6 !important;
			/* ãƒ›ãƒãƒ¼ã§ã‚‚è‰²å¤‰ã‚ã‚‰ãªã„ */
			color: #495057 !important;
		}

		.logo-img {
			height: auto;
			width: 180px;
		}


		button {
			transition: all 0.2s ease-in-out;
		}

		.btn-nowrap {
			white-space: nowrap;
			padding-left: 0.5rem;
			padding-right: 0.5rem;
		}

		.swiper {
			height: auto;
			max-height: none;
		}

		.swiper-slide {
			display: block;
			padding: 2rem;
			min-height: 100vh;
		}

		.swiper-wrapper {
			overflow: visible !important;
		}

		.swiper-slide p {
			font-size: 2.0rem;
			/* æ­Œè©ã‚’å¤§ãã‚ã« */
			line-height: 1.5
		}

		.swiper-slide .text-secondary.small {
			font-size: 1.5rem;
			/* æ„å‘³ã‚‚ã‚„ã‚„å¤§ãã‚ã« */
		}

		.swiper-slide p:last-child {
			margin-bottom: 20vh;
			/* æ„å‘³ã®ä¸‹ã«ä½™ç™½ */
		}

		#messageSelect {
			font-size: 1.25rem;
			padding: 0.75rem 1rem;
		}

		.playback-btn {
			width: 100%;
			padding: 0.75rem;
			font-size: 1rem;
			border: 1px solid #6c757d;
			background-color: #fff;
			color: #495057;
			border-radius: 2rem;
			box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
			transition: all 0.2s ease-in-out;
		}

		.playback-btn:hover {
			background-color: #f8f9fa;
			color: #000;
		}

		/* ç¸¦å‘ã or å°ã•ã„ç”»é¢æ™‚ â†’ ä»Šã¾ã§é€šã‚Š ç¸¦ä¸¦ã³ */
		@media (max-width: 767.98px) and (orientation: portrait) {
			.swiper-slide .lyrics-meaning-wrapper {
				display: block;
			}

			.lyrics-meaning-wrapper .lyrics {
				font-size: 1.8rem;
				color: #212529;
				margin-bottom: 1rem;
			}

			.lyrics-meaning-wrapper .meaning {
				font-size: 1.1rem;
				color: #6c757d;
			}
		}

		/* æ¨ªä¸¦ã³ã®ã¨ãã¯æ„å‘³ã®æ–‡å­—ã‚µã‚¤ã‚ºã ã‘æƒãˆã‚‹ */
		@media (min-width: 768px),
		(orientation: landscape) {
			.swiper-slide .lyrics-meaning-wrapper {
				display: flex;
				gap: 2rem;
				align-items: flex-start;
				justify-content: space-between;
			}

			.lyrics-meaning-wrapper .lyrics {
				flex: 1;
				font-size: 1.8rem;
				/* ãã®ã¾ã¾ */
				color: #212529;
				/* é€šå¸¸ã®é»’ */
			}

			.lyrics-meaning-wrapper .meaning {
				flex: 1;
				font-size: 1.8rem;
				/* æ„å‘³ã‚‚æ­Œè©ã¨åŒã˜å¤§ãã•ã«ã™ã‚‹ */
				color: #6c757d;
				/* ã“ã‚Œã¾ã§é€šã‚Šã®ã‚°ãƒ¬ãƒ¼ */
			}
		}

		.blank {
			display: inline-block;
			font-family: "Noto Sans JP", monospace;
			padding: 0 0.3em;
			min-width: 1.2em;
			white-space: nowrap;
			text-align: center;
			vertical-align: middle;
			overflow: hidden;
			border-bottom: 1px dotted #ccc;
			cursor: pointer;
		}


		.revealed {
			font-weight: bold;
		}
	</style>
</head>

<body>
	<div class="container py-3">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<img src="./logo.png" alt="ã²ãŸã¡å…‰æ•™ä¼šã‚¢ãƒ—ãƒª ãƒ­ã‚´" class="logo-img">
			<a class="btn btn-outline-primary shadow-sm rounded-pill px-4 py-2 fw-bold d-flex align-items-center gap-2"
				href="https://hitachihikari.net" target="_blank">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
					class="bi bi-house-door" viewBox="0 0 16 16">
					<path
						d="M8.354 1.146a.5.5 0 0 0-.708 0L1.5 7.293V14.5A1.5 1.5 0 0 0 3 16h3.5v-4.5A1.5 1.5 0 0 1 8 10h0a1.5 1.5 0 0 1 1.5 1.5V16H13a1.5 1.5 0 0 0 1.5-1.5V7.293l-6.146-6.147z" />
					<path d="M13 2.5v-.793l.354.353a.5.5 0 0 1-.708.708L13 2.5z" />
				</svg>
				ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
			</a>
			<button
				class="btn btn-outline-primary shadow-sm rounded-pill px-4 py-2 fw-bold d-flex align-items-center gap-2"
				onclick="location.reload()">
				ğŸ”„ ã‚¢ãƒ—ãƒªæ›´æ–°
			</button>
		</div>

		<div id="installPromptContainer" class="text-center my-3" style="display: none;">
			<button id="installBtn" class="btn btn-primary">
				ğŸ“± ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ 
			</button>
		</div>
		<div id="iosInstallGuide" class="text-center text-muted my-3" style="display: none;">
			ğŸ“± iPhoneã‚’ã”åˆ©ç”¨ã®æ–¹ã¯Safariã®ã€Œå…±æœ‰ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
		</div>


		<ul class="nav nav-tabs mb-3" id="tabMenu" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="message-tab" data-bs-toggle="tab" data-bs-target="#message-tab-pane"
					type="button" role="tab" aria-controls="message-tab-pane" aria-selected="true">èª¬æ•™åèŠ»</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="hymn-tab" data-bs-toggle="tab" data-bs-target="#hymn-tab-pane"
					type="button" role="tab" aria-controls="hymn-tab-pane" aria-selected="false">è–æ­Œæ­Œè©</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="test-tab" data-bs-toggle="tab" data-bs-target="#test-tab-pane"
					type="button" role="tab" aria-controls="test-tab-pane" aria-selected="false">æš—å”±è–å¥</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="test2-tab" data-bs-toggle="tab" data-bs-target="#test2-tab-pane"
					type="button" role="tab" aria-controls="test2-tab-pane" aria-selected="false">å®Ÿé¨“ coming
					soon!</button>
			</li>
		</ul>

		<div class="tab-content" id="tabContent">
			<div class="tab-pane fade show active" id="message-tab-pane" role="tabpanel" aria-labelledby="message-tab">
				<div class="mb-3">
					<label for="messageSelect" class="form-label fs-5 fw-semibold text-primary">
						ğŸ§ ç¤¼æ‹èª¬æ•™ã‚’é¸ã‚“ã§ãã ã•ã„
					</label>
					<select class="form-select form-select-lg shadow-sm border-primary" id="messageSelect"></select>
				</div>
				<div id="message" class="mb-4"></div>
				<div id="customPlayButton" class="text-center my-3">
					<button id="playToggle" class="btn btn-success rounded-circle shadow"
						style="width: 72px; height: 72px; font-size: 2rem; color: white;">
						â–¶
					</button>
				</div>
				<div class="row g-1 mb-1">
					<div class="col-3"><button class="btn btn-hhc" onclick="skip(-30)">30ç§’</button></div>
					<div class="col-3"><button class="btn btn-hhc" onclick="skip(-5)">5ç§’</button></div>
					<div class="col-3"><button class="btn btn-hhc" onclick="skip(5)">5ç§’&gt;&gt;</button></div>
					<div class="col-3"><button class="btn btn-hhc" onclick="skip(30)">30ç§’&gt;&gt;</button></div>
				</div>
				<div class="row g-1 mb-1">
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(0.5)">x0.5</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(0.8)">x0.8</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(1.0)">x1.0</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(1.5)">x1.5</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(2.0)">x2.0</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="rateup(2.5)">x2.5</button></div>
				</div>
				<div class="row g-1 mb-1">
					<div class="col-2"><button class="btn btn-hhc" onclick="move(600)">10åˆ†</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="move(1200)">20åˆ†</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="move(1800)">30åˆ†</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="move(2400)">40åˆ†</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="move(3000)">50åˆ†</button></div>
					<div class="col-2"><button class="btn btn-hhc" onclick="move(3600)">60åˆ†</button></div>
				</div>

				<div class="row mb-3 g-2">
					<div class="col">
						<button class="btn" onclick="toggleView('pptContainer')">
							ğŸ“½ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã‚‹
						</button>
					</div>
					<div class="col">
						<button class="btn" onclick="toggleView('weeklyReport')">
							ğŸ“° é€±å ±ã‚’è¦‹ã‚‹
						</button>
					</div>
					<div class="col">
						<button class="btn" onclick="toggleView('schedule')">
							ğŸ“… äºˆå®šè¡¨ã‚’è¦‹ã‚‹
						</button>
					</div>
				</div>


				<div id="pptContainer" style="display: none;">
					<div style="max-width: 1000px; margin: auto; aspect-ratio: 4 / 3; position: relative;">
						<!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
						<div id="pptLoading" class="d-flex justify-content-center align-items-center"
							style="position: absolute; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 1;">
							<span class="spinner-border text-primary" role="status" aria-hidden="true"></span>
							<span class="ms-2">èª­ã¿è¾¼ã¿ä¸­...</span>
						</div>

						<iframe id="pptFrame" src="" allowfullscreen
							style="position: absolute; width: 100%; height: 100%; border: none; z-index: 2;">
						</iframe>
					</div>
				</div>

				<!-- é€±å ± -->
				<div id="weeklyReport" style="display: none;" class="mb-4">
					<div class="overflow-auto border rounded p-2" style="white-space: nowrap;">
						<img src="https://onedrive.live.com/embed?resid=DF8117155F580907%211927&authkey=%21AGrAIvgcSALoIlE"
							style="height: auto; width: 1000px;" alt="é€±å ±ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ï¼‰">
					</div>
				</div>

				<!-- äºˆå®šè¡¨ -->
				<div id="schedule" style="display: none;" class="mb-4">
					<div class="overflow-auto border rounded p-2" style="white-space: nowrap;">
						<img src="https://onedrive.live.com/embed?resid=DF8117155F580907%211348&authkey=%21AFqBOdaSYRks83Y"
							style="height: auto; width: 500px;" alt="äºˆå®šè¡¨ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ï¼‰">
					</div>
				</div>



			</div>

			<div class="tab-pane fade" id="hymn-tab-pane" role="tabpanel" aria-labelledby="hymn-tab">
				<div class="mb-3 text-center">
					<div id="hymnButtons" class="d-flex flex-wrap justify-content-left"></div>
				</div>
				<div class="swiper mySwiper" id="hymnSwiper">
					<div class="swiper-wrapper" id="hymnSlides"></div>
					<div class="swiper-pagination"></div>
					<div class="swiper-button-prev"></div>
					<div class="swiper-button-next"></div>
				</div>
			</div>

			<div class="tab-pane fade" id="test-tab-pane" role="tabpanel" aria-labelledby="test-tab">
				æ¯é€±ã®"é»„é‡‘ã®è–å¥"ã¨èª¬æ•™ä¸­ã«ã§ã¦ããŸ"æš—å”±ã—ã¦ã»ã—ã„è–æ›¸å€‹æ‰€"ã‚’è¦šãˆã‚‹ã‚²ãƒ¼ãƒ ã«ã—ã¦ã¿ã¾ã—ãŸï¼é›£æ˜“åº¦é¸ã¹ã¾ã™ï¼
				ä»–ã«ã‚‚è¿½åŠ ã—ãŸã„è–å¥ãŒã‚ã‚Œã°ã€ãœã²æ•™ãˆã¦ãã ã•ã„ï¼
				<details class="mb-3">
					<summary class="fs-5 fw-semibold text-primary">ğŸ® æš—å”±è–å¥ã‚²ãƒ¼ãƒ ã®ã‚„ã‚Šæ–¹ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹ãï¼‰</summary>
					<div class="mt-2">
						<ol>
							<li>ä¸‹ã®ã€ŒNo.â—¯â—¯ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ã€å‡ºé¡Œã™ã‚‹è–å¥ã‚’é¸ã³ã¾ã™ã€‚</li>
							<li>ã€Œé›£æ˜“åº¦ã€ã‚’é¸ã¶ã¨ã€éš ã‚Œã‚‹æ–‡å­—ã®é‡ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚</li>
							<li>è™«é£Ÿã„è¡¨ç¤ºã•ã‚ŒãŸè–å¥ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
							<li>â—¯â—¯ï¼ˆâ—ï¼‰ã®ã¨ã“ã‚ã‚’æŠ¼ã™ã¨ã€æ­£è§£ã®æ–‡å­—ãŒå‡ºã¦ãã¾ã™ã€‚</li>
							<li>è¦šãˆã¦ã‹ã‚‰ç­”ãˆåˆã‚ã›ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</li>
						</ol>
						<p class="mb-0">ğŸ’¡ æ–‡å­—ã‚µã‚¤ã‚ºã¯ã€Œï¼‹ã€ã€Œï¼ã€ãƒœã‚¿ãƒ³ã§èª¿æ•´ã§ãã¾ã™ã€‚</p>
					</div>
				</details>

				<div id="verseButtons" class="mb-3 d-flex flex-wrap gap-2"></div>
				<div class="controls mb-2">
					<strong>é›£æ˜“åº¦ï¼š</strong>
					<label><input type="radio" name="level" value="0.1"> ã‚„ã•ã—ã„</label>
					<label><input type="radio" name="level" value="0.3" checked> ãµã¤ã†</label>
					<label><input type="radio" name="level" value="0.6"> ã‚€ãšã‹ã—ã„</label>
					<label><input type="radio" name="level" value="1.0"> è¶…ã‚€ãš</label>
				</div>
				<div class="mb-2">
					<strong>æ–‡å­—ã‚µã‚¤ã‚ºï¼š</strong>
					<button class="btn btn-outline-secondary btn-sm" id="fontMinus">ï¼</button>
					<button class="btn btn-outline-secondary btn-sm" id="fontPlus">ï¼‹</button>
				</div>



				<h3>æš—å”±è–å¥ï¼š<span id="verseTitle">é¸æŠã—ã¦ãã ã•ã„</span></h3>
				<div id="verse" class="verse-area" style="margin-top: 1em;"></div>

			</div>

			<div class="tab-pane fade" id="test2-tab-pane" role="tabpanel" aria-labelledby="test-tab">
				coming soon!
			</div>



		</div>


		<script>
			let list = [];
			let swiperInstance;
			let pptLoaded = false;
			let currentVerse = null;
			let selaudio = ""; // ã‚°ãƒ­ãƒ¼ãƒãƒ«

			document.addEventListener("DOMContentLoaded", () => {
				// åˆæœŸåŒ–
				initMessage();
				initHymn();
				initVerse();
				initSlide();
				initInstallPrompt();
			});

			// èª¬æ•™æ©Ÿèƒ½
			function initMessage() {
				// èª¬æ•™ãƒªã‚¹ãƒˆå–å¾—ãƒ»è¡¨ç¤ºãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
				fetch("https://hitachihikari.net/message/list.json")
					.then(res => res.json())
					.then(data => {
						list = data;
						const select = document.getElementById("messageSelect");
						for (const item of list) {
							const opt = document.createElement("option");
							opt.value = item.val;
							opt.text = item.txt;
							select.appendChild(opt);
						}

						audioset();  // æœ€åˆã®èª¬æ•™ã‚’è¡¨ç¤º
						select.addEventListener("change", audioset);  // èª¬æ•™å¤‰æ›´æ™‚ã«å‘¼ã³å‡ºã™
					});

			}

			// è–æ­Œæ©Ÿèƒ½
			function initHymn() {
				// è–æ­Œãƒªã‚¹ãƒˆå–å¾—ãƒ»ãƒœã‚¿ãƒ³ç”Ÿæˆãƒ»æ­Œè©è¡¨ç¤º

				// è–æ­Œæ­Œè©ãƒªã‚¹ãƒˆ
				fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRGJMtcBrjSnLZZGMFKB0wPzh4v_hHF8nmIdpTzZtLcpx0LKM_VAruhWF9diTGVZ4kXewlbN_sIhcOC/pub?output=csv")
					.then(res => res.text())
					.then(csvText => {
						const parsed = Papa.parse(csvText, { header: false });
						const rows = parsed.data.slice(1);
						const hymnData = rows.map(cols => ({
							number: cols[1]?.trim(),
							verse: cols[2],
							text: cols[3],
							meaning: cols[5]
						}));

						const numbers = [...new Set(hymnData.map(row => row.number))]
							.map(n => parseInt(n))
							.filter(n => !isNaN(n))
							.sort((a, b) => a - b);

						const hymnButtons = document.getElementById('hymnButtons');
						numbers.forEach(num => {
							const btn = document.createElement('button');
							btn.className = 'btn btn-kashi';

							// æ„å‘³ãŒç©ºã®ã‚‚ã®ãŒ1ã¤ã§ã‚‚ã‚ã‚Œã°è‰²ã‚’å¤‰ãˆã‚‹
							const hasEmptyMeaning = hymnData.some(row =>
								row.number === String(num) && (!row.meaning || row.meaning.trim() === "")
							);

							if (hasEmptyMeaning) {
								btn.classList.add('btn-empty-meaning');
							} else {
								btn.classList.add('btn-outline-primary');
							}


							btn.textContent = num;

							btn.onclick = () => {
								// è‰²ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆå…¨ãƒœã‚¿ãƒ³ã‹ã‚‰activeé™¤å»â†’ã“ã®ãƒœã‚¿ãƒ³ã«è¿½åŠ ï¼‰
								document.querySelectorAll('.btn-kashi').forEach(b => b.classList.remove('active'));
								btn.classList.add('active');

								// æ­Œè©è¡¨ç¤º
								showLyrics(num, hymnData);
							};

							hymnButtons.appendChild(btn);
						});

					});




			}

			// æš—å”±è–å¥æ©Ÿèƒ½
			function initVerse() {
				// è–å¥ãƒªã‚¹ãƒˆå–å¾—ãƒ»ãƒœã‚¿ãƒ³ç”Ÿæˆãƒ»é›£æ˜“åº¦/æ–‡å­—ã‚µã‚¤ã‚ºç®¡ç†

				// æš—å”±è–å¥ã®èª­ã¿è¾¼ã¿
				// Google Sheetsã®CSV URL
				const verseCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRqLECO6yni4jcicwjRBODdGoTRYIQQbHDMfwn8QJ3o8Cb_KakgDV7mr6Qx6r5D5QP3iyfRFWtpCDpy/pub?output=csv";
				let verseList = [];

				// CSVã‚’èª­ã¿è¾¼ã‚“ã§ãƒœã‚¿ãƒ³ç”Ÿæˆ
				fetch(verseCsvUrl)
					.then(res => res.text())
					.then(csvText => {
						const parsed = Papa.parse(csvText, { header: true });
						verseList = parsed.data.filter(row => row['æœ¬æ–‡']?.trim());

						const container = document.getElementById("verseButtons");
						verseList.forEach(row => {
							const no = row['ç•ªå·']?.trim();
							const btn = document.createElement("button");
							btn.className = "btn btn-outline-primary btn-sm";
							btn.textContent = `${no}`;
							btn.onclick = () => {
								currentVerse = row;
								updateVerse(getCurrentLevel());
								document.getElementById("verseTitle").textContent = `${row['è–æ›¸å€‹æ‰€'] || 'ï¼ˆä¸æ˜ï¼‰'}`;
							};
							container.appendChild(btn);
						});

						// åˆæœŸè¡¨ç¤ºï¼šNo.1
						const first = verseList.find(row => row['ç•ªå·']?.trim() === "1");
						if (first) {
							currentVerse = first;
							updateVerse(0.1);
							document.getElementById("verseTitle").textContent = first['è–æ›¸å€‹æ‰€'] || 'ï¼ˆä¸æ˜ï¼‰';
						}
					});

				// é›£æ˜“åº¦ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
				function getCurrentLevel() {
					return parseFloat(document.querySelector('input[name="level"]:checked').value);
				}

				// é›£æ˜“åº¦å¤‰æ›´æ™‚ã®æ›´æ–°
				function updateVerse(percent) {
					if (!currentVerse) return;

					const verseContainer = document.getElementById("verse");
					const reference = currentVerse['è–æ›¸å€‹æ‰€'] || 'ï¼ˆä¸æ˜ï¼‰';
					const text = currentVerse['æœ¬æ–‡'] || '';

					// å†åº¦ makeBlanksWithAnswers ã‚’å‘¼ã³å‡ºã—ã¦ã€DOM ã‚’ä¸Šæ›¸ã
					const html = `<p><strong>${reference}</strong><br>${makeBlanksWithAnswers(text, percent)}</p>`;
					verseContainer.innerHTML = html;
				}

				document.querySelectorAll('input[name="level"]').forEach(radio => {
					radio.addEventListener("change", e => {
						if (currentVerse) {
							updateVerse(parseFloat(e.target.value));
						}
					});
				});

				let currentFontSize = 40;  // åˆæœŸãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºï¼ˆpxï¼‰
				applyFontSize();

				function applyFontSize() {
					document.getElementById("verse").style.fontSize = currentFontSize + "px";
				}

				document.getElementById("fontPlus").addEventListener("click", () => {
					if (currentFontSize < 60) {
						currentFontSize += 2;
						applyFontSize();
					}
				});

				document.getElementById("fontMinus").addEventListener("click", () => {
					if (currentFontSize > 12) {
						currentFontSize -= 2;
						applyFontSize();
					}
				});
			}

			// ã‚¹ãƒ©ã‚¤ãƒ‰æ©Ÿèƒ½
			function initSlide() {
				// ã‚¹ãƒ©ã‚¤ãƒ‰è¡¨ç¤ºãƒ»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç®¡ç†
				// ã‚¹ãƒ©ã‚¤ãƒ‰èª­ã¿è¾¼ã¿ï¼ˆåˆå›ï¼‰
				const iframe = document.getElementById('pptFrame');
				const loader = document.getElementById('pptLoading');
				loader.style.display = 'flex';

				iframe.onload = () => {
					loader.style.display = 'none';
					pptLoaded = true;
				};

				iframe.src = "https://onedrive.live.com/embed?cid=DF8117155F580907&resid=DF8117155F580907%211340&authkey=AF6P8Ar7u7YupbA&em=2&wdAr=1.00&wdEaa=0";

				// å¿µã®ãŸã‚5ç§’ã§éè¡¨ç¤ºï¼ˆå¤±æ•—å¯¾ç­–ï¼‰
				setTimeout(() => {
					if (!pptLoaded) loader.style.display = 'none';
				}, 5000);


			}

			// PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…
			function initInstallPrompt() {
				// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³è¡¨ç¤ºãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
			}



			document.getElementById("playToggle").addEventListener("click", () => {
				audioset(); // æ¯å›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç”Ÿæˆãƒ»åŒæœŸã—ç›´ã™
			});




			function toggleView(targetId) {
				document.getElementById('pptContainer').style.display = 'none';
				document.getElementById('weeklyReport').style.display = 'none';
				document.getElementById('schedule').style.display = 'none';

				document.getElementById(targetId).style.display = 'block';

				if (targetId === 'pptContainer') {
					const loader = document.getElementById('pptLoading');
					if (!pptLoaded) {
						loader.style.display = 'flex';
					} else {
						loader.style.display = 'none';
					}
				}
			}


			function audioset() {
				const select = document.getElementById("messageSelect");
				if (!select.value) return;

				const selaudio = select.value.substring(0, 8);  // â†é‡è¦
				const audio = new Audio("./m4a/" + selaudio + ".m4a");
				audio.controls = true;
				audio.style.width = '100%';
				audio.id = "audio";
				audio.preload = "auto";

				const messageDiv = document.getElementById("message");
				messageDiv.innerHTML = '';
				messageDiv.appendChild(audio);

				const storageKey = "audio_position_" + selaudio;
				const savedTime = localStorage.getItem(storageKey);
				if (savedTime && !isNaN(savedTime)) {
					audio.currentTime = parseFloat(savedTime);
				}

				const intervalId = setInterval(() => {
					if (!audio.paused && !audio.ended) {
						localStorage.setItem(storageKey, audio.currentTime);
					}
				}, 3000);

				let isPlaying = false;

				const playBtnContainer = document.getElementById("customPlayButton");
				const oldBtn = document.getElementById("playToggle");
				const newBtn = oldBtn.cloneNode(true);
				oldBtn.parentNode.replaceChild(newBtn, oldBtn);
				const playIcon = newBtn;

				audio.addEventListener("play", () => {
					playIcon.innerText = 'â¸';
					isPlaying = true;
				});
				audio.addEventListener("pause", () => {
					playIcon.innerText = 'â–¶';
					if (isPlaying) {
						sendLog("audio_stop", {
							filename: selaudio,
							currentTime: audio.currentTime
						});
						isPlaying = false;
					}
					localStorage.setItem(storageKey, audio.currentTime);
				});

				audio.addEventListener("ended", () => {
					localStorage.removeItem(storageKey);
					playIcon.innerText = 'â–¶';
					isPlaying = false;
				});

				newBtn.addEventListener("click", () => {
					if (audio.paused) {
						audio.play();
						sendLog("audio_play", { filename: selaudio });
					} else {
						audio.pause();
					}
				});
			}


			function sendLog(eventType, data) {
				fetch("https://script.google.com/macros/s/ã€ã‚ãªãŸã®GAS URLã€‘/exec", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({
						event: eventType,
						userAgent: navigator.userAgent,
						device: /mobile/i.test(navigator.userAgent) ? "Mobile" : "Desktop",
						...data
					})
				}).then(res => res.text())
					.then(text => console.log("ãƒ­ã‚°é€ä¿¡æˆåŠŸ:", text))
					.catch(err => console.error("ãƒ­ã‚°é€ä¿¡å¤±æ•—:", err));
			}

			function skip(seconds) {
				const audio = document.getElementById("audio");
				if (audio) {
					audio.play();
					audio.currentTime += seconds;
				}
			}

			function move(seconds) {
				const audio = document.getElementById("audio");
				if (audio) {
					audio.play();
					audio.currentTime = seconds;
				}
			}

			function rateup(speed) {
				const audio = document.getElementById("audio");
				if (audio) {
					audio.play();
					audio.playbackRate = speed;
				}
			}

			function showLyrics(number, data) {
				const results = data.filter(entry => entry.number === number.toString());
				const wrapper = document.getElementById('hymnSlides');
				wrapper.innerHTML = '';

				if (!results.length) {
					wrapper.innerHTML = `<div class="swiper-slide text-center"><p class="text-danger">ç•ªå· ${number} ã®æ­Œè©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p></div>`;
				} else {
					results.forEach(({ number, verse, text, meaning }) => {
						const slide = document.createElement('div');
						slide.className = 'swiper-slide';
						slide.innerHTML = `
                <h5 class="mb-3">è–æ­Œ ${number}ç•ªãƒ»ç¬¬ ${verse} ç¯€</h5>
                <div class="lyrics-meaning-wrapper">
                    <div class="lyrics">${text?.replace(/\n/g, '<br>')}</div>
                    <div class="meaning">${meaning?.replace(/\n/g, '<br>')}</div>
                </div>
            `;
						wrapper.appendChild(slide);
					});
				}

				if (swiperInstance) swiperInstance.destroy(true, true);
				swiperInstance = new Swiper('.mySwiper', {
					direction: 'horizontal',
					loop: false,
					autoHeight: true,
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
					},
					navigation: {
						nextEl: '.swiper-button-next',
						prevEl: '.swiper-button-prev',
					},
				});
				scrollToLyrics();
			}



			function scrollToLyrics() {
				const swiperContainer = document.getElementById('hymnSwiper');
				const offsetTop = swiperContainer.getBoundingClientRect().top + window.scrollY;

				window.scrollTo({
					top: offsetTop,
					behavior: 'smooth'
				});
			}

			function toggleView(targetId) {
				document.getElementById('pptContainer').style.display = 'none';
				document.getElementById('weeklyReport').style.display = 'none';
				document.getElementById('schedule').style.display = 'none';

				document.getElementById(targetId).style.display = 'block';

				if (targetId === 'pptContainer') {
					const loader = document.getElementById('pptLoading');
					const iframe = document.getElementById('pptFrame');

					if (!pptLoaded) {
						loader.style.display = 'flex';
						iframe.onload = () => {
							loader.style.display = 'none';
							pptLoaded = true;
						};
					} else {
						loader.style.display = 'none'; // ã™ãæ¶ˆã™
					}
				}
			}
			let deferredPrompt = null;

			window.addEventListener('beforeinstallprompt', (e) => {
				// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
				e.preventDefault();
				deferredPrompt = e;

				// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
				const installContainer = document.getElementById('installPromptContainer');
				if (installContainer) {
					installContainer.style.display = 'block';
				}
			});


			function makeBlanksWithAnswers(text, percentHidden = 0.3) {
				const segmenter = new TinySegmenter();
				let words = segmenter.segment(text);

				// 1æ–‡å­—èªã‚’å‰ã«ãã£ã¤ã‘ã‚‹ï¼ˆåŠ©è©ãªã©ï¼‰
				for (let i = words.length - 1; i > 0; i--) {
					if (words[i].length === 1 && words[i].match(/[ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¥]/)) {
						words[i - 1] += words[i];
						words.splice(i, 1);
					}
				}

				// å¥èª­ç‚¹ä»¥å¤–ã®å˜èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã ã‘ã‚’å¯¾è±¡ã«ã™ã‚‹
				const wordIndices = words.map((_, i) => i).filter(i =>
					//	!words[i].match(/^[ã€ã€‚ï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰\[\]ï½›ï½\s]+$/)
					!words[i].match(/^[ã€ã€‚ï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰\[\]ï½›ï½\s\p{P}\p{S}]+$/u)
					&&
					!words[i].match(/^\d+$/)

				);

				const hideCount = percentHidden >= 1.0
					? wordIndices.length
					: Math.max(1, Math.floor(wordIndices.length * percentHidden));

				const targets = wordIndices.sort(() => Math.random() - 0.5).slice(0, hideCount);

				let colorToggle = true;

				return words.map((w, i) => {
					if (targets.includes(i)) {
						const maskChar = colorToggle ? 'â—' : 'â—‹';
						colorToggle = !colorToggle;
						return `<span class="blank" data-answer="${w}">${maskChar.repeat([...w].length)}</span>`;
					} else {
						return w;
					}
				}).join('');
			}




			// (1) "updateVerseFromData" ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ä»£ã‚ã‚Šã«ã€ŒupdateVerseã€ã®å†…éƒ¨ã§ç›´æ¥æ›¸ãæ›ãˆã‚‹
			// (2) é›£æ˜“åº¦ã‚’å¤‰æ›´ã—ãŸã‚‰ã™ãåæ˜ ã•ã›ã‚‹ã‚ˆã†ã€"updateVerse" ã‚’è¦å‹•

			function updateVerse(percent) {
				if (!currentVerse) return;

				const verseContainer = document.getElementById("verse");
				const reference = currentVerse['è–æ›¸å€‹æ‰€'] || 'ï¼ˆä¸æ˜ï¼‰';
				const text = currentVerse['æœ¬æ–‡'] || '';

				const html = `<p><strong>${reference}</strong><br>${makeBlanksWithAnswers(text, percent)}</p>`;
				verseContainer.innerHTML = html;
				applyFontSize();
			}

			// é›£æ˜“åº¦ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã«å¤‰æ›´ç›¸å¿œã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ã¤ã‘ã‚‹
			// ã“ã“ã«å†åº¦æ›´ã‚ã¦è¿½åŠ 





			document.addEventListener("click", function (e) {
				if (e.target.classList.contains("blank")) {
					e.target.textContent = e.target.dataset.answer;
					e.target.classList.remove("blank");
					e.target.classList.add("revealed");
				}
			});

			updateVerse(0.1); // åˆæœŸè¡¨ç¤º





			document.getElementById('installBtn').addEventListener('click', () => {
				if (deferredPrompt) {
					deferredPrompt.prompt(); // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

					deferredPrompt.userChoice.then((choiceResult) => {
						if (choiceResult.outcome === 'accepted') {
							console.log('PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸ');
						} else {
							console.log('PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‹’å¦');
						}
						// äºŒåº¦è¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«æ¶ˆã™
						deferredPrompt = null;
						document.getElementById('installPromptContainer').style.display = 'none';
					});
				}
			});

			window.addEventListener('load', () => {
				const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
				const isInStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

				if (isIOS && !isInStandalone) {
					document.getElementById('iosInstallGuide').style.display = 'block';
				}
			});


			// å…±é€šãƒ­ã‚°é€ä¿¡é–¢æ•°
			function sendLog(event, data = {}) {
				fetch("https://script.google.com/macros/s/AKfycbxXZLDgDZnPgZn3QFFCVlglutf4zU0k7UoMeZLhY6IIzx5us7M-7F9OOs5K5rdNLoZjWg/exec", {
					method: "POST",
					mode: "no-cors",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({
						event,
						userAgent: navigator.userAgent,
						device: /mobile/i.test(navigator.userAgent) ? "Mobile" : "Desktop",
						timestamp: Date.now(),
						...data
					})
				});
			}

			// æš—å”±è–å¥ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
			btn.onclick = () => {
				currentVerse = row;
				updateVerse(getCurrentLevel());
				document.getElementById("verseTitle").textContent = `${row['è–æ›¸å€‹æ‰€'] || 'ï¼ˆä¸æ˜ï¼‰'}`;
				sendLog("verse_select", {
					number: row['ç•ªå·'],
					verse: row['è–æ›¸å€‹æ‰€']
				});
			};

			// é›£æ˜“åº¦å¤‰æ›´æ™‚
			const radios = document.querySelectorAll('input[name="level"]');
			radios.forEach((radio) => {
				radio.addEventListener("change", () => {
					const level = getCurrentLevel();
					updateVerse(level);
					sendLog("level_change", { level });
				});
			});

			// ãƒã‚¹ã‚¯è§£é™¤ï¼ˆç­”ãˆã‚’è¦‹ã‚‹ï¼‰æ™‚
			document.addEventListener("click", function (e) {
				if (e.target.classList.contains("blank")) {
					sendLog("reveal_word", {
						answer: e.target.dataset.answer
					});
					e.target.textContent = e.target.dataset.answer;
					e.target.classList.remove("blank");
					e.target.classList.add("revealed");
				}
			});

			// ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºå¤‰æ›´
			document.getElementById("fontPlus").onclick = () => {
				fontSize += 2;
				updateFontSize();
				sendLog("font_resize", { action: "plus", fontSize });
			};
			document.getElementById("fontMinus").onclick = () => {
				fontSize = Math.max(10, fontSize - 2);
				updateFontSize();
				sendLog("font_resize", { action: "minus", fontSize });
			};



		</script>
</body>

</html>
