<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠç±³å…±åŒè³¼å…¥è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f3f4f6; }
        .input-num { text-align: right; }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-lg pb-20">
        <header class="bg-green-600 text-white p-4 sticky top-0 z-10 flex justify-between items-center">
            <h1 class="font-bold text-lg">ğŸŒ¾ ãŠç±³è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
            <button @click="resetData" class="text-xs bg-green-800 px-2 py-1 rounded">åˆæœŸåŒ–</button>
        </header>

        <div class="p-4 space-y-6">
            
            <section class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h2 class="font-bold text-gray-700 mb-3 border-b pb-1">â‘  ä»Šæœˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="text-xs text-gray-500 block">ç™½ç±³å˜ä¾¡ (å††/kg)</label>
                        <input type="number" v-model.number="prices.white" class="w-full border rounded p-2 input-num text-lg">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block">èƒšèŠ½ç±³å˜ä¾¡ (å††/kg)</label>
                        <input type="number" v-model.number="prices.germ" class="w-full border rounded p-2 input-num text-lg">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block">ç„ç±³å˜ä¾¡ (å††/kg)</label>
                        <input type="number" v-model.number="prices.brown" class="w-full border rounded p-2 input-num text-lg">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block font-bold text-red-600">é€æ–™åˆè¨ˆ (ä¼ç¥¨)</label>
                        <input type="number" v-model.number="shippingTotal" class="w-full border-red-300 border-2 rounded p-2 input-num text-lg bg-red-50">
                    </div>
                </div>
            </section>

            <section>
                <div class="flex justify-between items-end mb-3">
                    <h2 class="font-bold text-gray-700 border-b pb-1">â‘¡ æ³¨æ–‡å…¥åŠ› ({{ users.length }}äºº)</h2>
                    <button @click="addUser" class="text-sm bg-blue-500 text-white px-3 py-1 rounded shadow">+ è¿½åŠ </button>
                </div>

                <div v-for="(user, index) in users" :key="index" class="bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm">
                    <div class="flex justify-between mb-2">
                        <input type="text" v-model="user.name" class="font-bold text-lg w-1/2 border-b border-dashed focus:outline-none" placeholder="åå‰">
                        <button @click="removeUser(index)" class="text-xs text-gray-400">å‰Šé™¤</button>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mb-3">
                        <div class="text-center">
                            <label class="text-xs text-gray-500 block">ç™½ç±³kg</label>
                            <input type="number" v-model.number="user.white" class="w-full border rounded p-1 text-center bg-gray-50">
                        </div>
                        <div class="text-center">
                            <label class="text-xs text-gray-500 block">èƒšèŠ½kg</label>
                            <input type="number" v-model.number="user.germ" class="w-full border rounded p-1 text-center bg-gray-50">
                        </div>
                        <div class="text-center">
                            <label class="text-xs text-gray-500 block">ç„ç±³kg</label>
                            <input type="number" v-model.number="user.brown" class="w-full border rounded p-1 text-center bg-gray-50">
                        </div>
                    </div>

                    <div class="bg-green-50 p-2 rounded text-sm flex justify-between items-center">
                        <div>
                            <span class="block text-xs text-gray-600">é‡é‡: {{ calcUserWeight(user) }}kg</span>
                            <span class="block text-xs text-gray-600">é€æ–™è² æ‹…: Â¥{{ calcUserShipping(user).toLocaleString() }}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500">è«‹æ±‚é¡</div>
                            <div class="font-bold text-xl text-green-700">Â¥{{ calcUserTotal(user).toLocaleString() }}</div>
                        </div>
                    </div>
                    
                    <button @click="copyLine(user)" class="mt-2 w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded flex justify-center items-center gap-2">
                        <span v-if="user.copied">âœ… ã‚³ãƒ”ãƒ¼å®Œäº†</span>
                        <span v-else>ğŸ’¬ LINEç”¨ã«ã‚³ãƒ”ãƒ¼</span>
                    </button>
                </div>
            </section>

            <section class="bg-gray-800 text-white p-4 rounded-lg shadow-lg mb-8">
                <h2 class="text-xs text-gray-400 mb-2">å…¨ä½“æ¤œç®— (ãƒã‚§ãƒƒã‚¯ç”¨)</h2>
                <div class="flex justify-between items-center border-b border-gray-600 pb-2 mb-2">
                    <span>ãŠç±³ä»£åˆè¨ˆ</span>
                    <span>Â¥{{ totalRicePrice.toLocaleString() }}</span>
                </div>
                <div class="flex justify-between items-center border-b border-gray-600 pb-2 mb-2">
                    <span>é‡é‡åˆè¨ˆ</span>
                    <span>{{ totalWeight }} kg</span>
                </div>
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>è«‹æ±‚ç·é¡</span>
                    <span :class="{'text-red-400': !isBalanced, 'text-green-400': isBalanced}">
                        Â¥{{ grandTotal.toLocaleString() }}
                    </span>
                </div>
                <div v-if="!isBalanced" class="mt-2 text-xs text-red-300 text-right">
                    â€»è¨ˆç®—ä¸Šã®ç«¯æ•°ãªã©ã«ã‚ˆã‚Šå¾®ç´°ãªã‚ºãƒ¬ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
                </div>
            </section>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                    prices: { white: 400, germ: 450, brown: 380 },
                    shippingTotal: 1500,
                    users: [
                        { name: 'Aã•ã‚“', white: 5, germ: 0, brown: 0, copied: false },
                        { name: 'Bã•ã‚“', white: 0, germ: 2, brown: 2, copied: false },
                    ]
                }
            },
            mounted() {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
                const saved = localStorage.getItem('rice-app-data');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    this.prices = parsed.prices;
                    this.users = parsed.users;
                    // é€æ–™ã¯æ¯å›å¤‰ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒã€ä¸€æ—¦ä¿å­˜ã—ãŸã‚‚ã®ã‚’å¾©å…ƒ
                    this.shippingTotal = parsed.shippingTotal; 
                }
            },
            watch: {
                // ãƒ‡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã«è‡ªå‹•ä¿å­˜
                '$data': {
                    handler(newVal) {
                        localStorage.setItem('rice-app-data', JSON.stringify(newVal));
                    },
                    deep: true
                }
            },
            computed: {
                totalWeight() {
                    return this.users.reduce((sum, u) => sum + (u.white || 0) + (u.germ || 0) + (u.brown || 0), 0);
                },
                totalRicePrice() {
                    return this.users.reduce((sum, u) => sum + this.calcUserRicePrice(u), 0);
                },
                grandTotal() {
                    // å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ”¯æ‰•ã„åˆè¨ˆã®ç·å’Œï¼ˆç«¯æ•°å‡¦ç†å¾Œã®åˆè¨ˆï¼‰
                    return this.users.reduce((sum, u) => sum + this.calcUserTotal(u), 0);
                },
                isBalanced() {
                    // å˜ç´”ãªæ¤œç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦å³å¯†åŒ–ï¼‰
                    return true; 
                }
            },
            methods: {
                addUser() {
                    this.users.push({ name: '', white: 0, germ: 0, brown: 0, copied: false });
                },
                removeUser(index) {
                    if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) this.users.splice(index, 1);
                },
                resetData() {
                    if(!confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) return;
                    localStorage.removeItem('rice-app-data');
                    location.reload();
                },
                // è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
                calcUserWeight(user) {
                    return (user.white || 0) + (user.germ || 0) + (user.brown || 0);
                },
                calcUserRicePrice(user) {
                    return (user.white * this.prices.white) + 
                           (user.germ * this.prices.germ) + 
                           (user.brown * this.prices.brown);
                },
                calcUserShipping(user) {
                    if (this.totalWeight === 0) return 0;
                    const weight = this.calcUserWeight(user);
                    // é‡é‡æ¯”ç‡ã§é€æ–™æŒ‰åˆ† (Math.ceilã§åˆ‡ã‚Šä¸Šã’ã—ã¦ä¸è¶³ãŒå‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ã‹ã€roundã«ã™ã‚‹ã‹ã¯ãŠå¥½ã¿ã§)
                    // ã“ã“ã§ã¯ä¸€èˆ¬çš„ãªå››æ¨äº”å…¥ã«ã—ã¦ã„ã‚‹
                    return Math.round(this.shippingTotal * (weight / this.totalWeight));
                },
                calcUserTotal(user) {
                    return this.calcUserRicePrice(user) + this.calcUserShipping(user);
                },
                // LINEã‚³ãƒ”ãƒ¼
                async copyLine(user) {
                    const total = this.calcUserTotal(user);
                    const shipping = this.calcUserShipping(user);
                    const details = [];
                    if(user.white) details.push(`ç™½ç±³: ${user.white}kg`);
                    if(user.germ) details.push(`èƒšèŠ½: ${user.germ}kg`);
                    if(user.brown) details.push(`ç„ç±³: ${user.brown}kg`);

                    const text = `
ã€ä»Šæœˆã®ãŠç±³ä»£ã€‘
${user.name}ã•ã‚“

ã”æ³¨æ–‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ä»Šæœˆã®å†…è¨³ã§ã™ã€‚

â– æ³¨æ–‡å†…å®¹
${details.join('\n')}

â– é‡‘é¡
ãŠç±³ä»£: Â¥${this.calcUserRicePrice(user).toLocaleString()}
é€æ–™åˆ†: Â¥${shipping.toLocaleString()} (é‡é‡å‰²)
----------------
åˆè¨ˆ: Â¥${total.toLocaleString()}

ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼
`.trim();

                    try {
                        await navigator.clipboard.writeText(text);
                        user.copied = true;
                        setTimeout(() => user.copied = false, 2000);
                    } catch (err) {
                        alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
